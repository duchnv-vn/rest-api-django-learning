name: Develop environment deployment

on:
  push:
    branches:
      - "dev"

jobs:
  vps-pull:
    name: VPS pulls and run Docker container
    runs-on: bash
    steps:
      - name: Connect to VPS
        env:
          HOST: ${{ secrets.HOST }}
          USERNAME: ${{ secrets.USERNAME }}
          PASSWORD: ${{ secrets.PASSWORD }}
          PORT: ${{ secrets.PORT }}
          SOURCE_DIR: ${{ secrets.SOURCE_DIR }}
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: $HOST
          username: $USERNAME
          password: $PASSWORD
          port: $PORT
          script: |
            cd "./$SOURCE_DIR"
            git pull
            docker-compose -f docker-compose-deploy.yml up -d
